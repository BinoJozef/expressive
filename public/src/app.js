function checkAuth($cookies,auth){var token=$cookies.get("token");return token?auth.checkLogin(token).then(function(res){return res.data.success?res.data.user:!1},function(err){return!1}):!1}angular.module("App",["ngRoute","ngCookies","ngMaterial","ngMessages","Service","Function","Controller","md.data.table"]).config(function($routeProvider,$locationProvider){$routeProvider.when("/dashboard",{templateUrl:"/templates/dashboard.html",controller:"DashboardCtrl"}).when("/login",{templateUrl:"/templates/login.html",controller:"LoginCtrl"}).when("/table",{templateUrl:"/templates/table.html",controller:"TableCtrl"}).otherwise({redirectTo:"/dashboard"}),$locationProvider.html5Mode(!0)}).config(function($mdThemingProvider){$mdThemingProvider.theme("default").primaryPalette("blue").accentPalette("pink")}).directive("navMenu",function(){return{restrict:"E",templateUrl:"templates/side-menu.html"}}),angular.module("Controller",[]).controller("NavCtrl",function($scope,$mdSidenav,auth,$cookies,$window){var userAuth=checkAuth($cookies,auth);$scope.loggedin=!1,userAuth&&($scope.loggedin=!0),$scope.toggleLeft=function(){$mdSidenav("left").toggle()},$scope.close=function(){$mdSidenav("left").close()},$scope.logout=function(){$cookies.remove("token"),$window.location.href="/home"}}).controller("DashboardCtrl",function($scope,$location){}).controller("LoginCtrl",function($scope,$window,auth,$cookies,$location){checkAuth($cookies,auth)&&$location.path("/home"),$scope.promise=!1,$scope.doLogin=function(){$scope.promise=!0,auth.doLogin(this.user).then(function(res){$cookies.put("token",res.data.token),console.log("tes"),res.data.success?$window.location.href="/home":($scope.promise=!1,$scope.message=res.data.message)},function(err){$scope.promise=!1,console.log(err)})};var height=$window.innerHeight;$scope.top=height/6}).controller("TableCtrl",function($scope,$location,$q,$mdDialog,user){function getUser(params){var deferred=$q.defer();$scope.promise=deferred.promise,params.attributes=["firstName","lastName","email","id"],params.order||(params.order="firstName"),user.getUsers(params).then(function(res){$scope.users=res.data.users,$scope.pagination.total=res.data.countAll,deferred.resolve()},function(err){$location.path("/login")})}function reloadUser(){getUser({limit:$scope.pagination.limit,offset:offset,order:$scope.order.replace("-",""),sort:sort}),$scope.selected=[]}function addFunction($scope,$mdDialog){$scope.save=function(){var data=this.user;user.addUser(data).then(function(res){console.log(res),res.data.success?(reloadUser(),$mdDialog.hide()):$scope.formMessage=res.data.message})},$scope.close=function(){$mdDialog.cancel()}}$scope.pagination={page:1,limit:5},$scope.order="firstName",$scope.selected=[];var offset=0,sort="ASC";getUser({limit:$scope.pagination.limit}),$scope.onReorder=function(order){sort="ASC",order.indexOf("-")||(sort="DESC",order=order.replace("-","")),getUser({limit:$scope.pagination.limit,offset:offset,order:order,sort:sort})},$scope.onPaginate=function(page,limit){offset=(page-1)*limit,getUser({limit:limit,offset:offset,order:$scope.order.replace("-",""),sort:sort})},$scope["delete"]=function(){var id=[];$scope.selected.forEach(function(element,index){id.push(element.id)});var params={id:id};user.deleteUser(params).then(function(res){reloadUser()})},$scope.addUser=function(ev){$mdDialog.show({controller:addFunction,templateUrl:"templates/add.html",parent:angular.element(document.body),targetEvent:ev,clickOutsideToClose:!0}).then(function(){})}}),angular.module("Function",[]);var app=angular.module("Service",["ngCookies"]);app.service("auth",function($http){var url="/api/auth";this.doLogin=function(user){return $http.post(url,user)},this.checkLogin=function(token){return $http.get("/api/authenticated/?token="+token)}}).service("user",function($http,$cookies){var url="/api/user",token=$cookies.get("token");this.addUser=function(data){return data.token=token,$http.post(url,data)},this.getUsers=function(params){return params.token=token,$http.get(url,{params:params})},this.getUser=function(id){return $http.get(url+"/"+id,{params:{token:token}})},this.deleteUser=function(params){return params.token=token,$http["delete"](url,{params:params})}});